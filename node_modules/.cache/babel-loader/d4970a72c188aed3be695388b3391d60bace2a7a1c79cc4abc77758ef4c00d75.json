{"ast":null,"code":"import React,{useState,useRef,useContext}from'react';import styles from'../styles/InputArea.module.css';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faPaperclip,faSmile,faPaperPlane}from'@fortawesome/free-solid-svg-icons';import ChatContext from'../../../components/ChatContext';import UserContext from'../../../components/UserContext';import Picker from'emoji-picker-react';// Updated import\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const InputArea=()=>{const{messages,setMessages,messageStatus,setMessageStatus,selectedChat,pendingQueue,setPendingQueue}=useContext(ChatContext);const{userId}=useContext(UserContext);const[inputValue,setInputValue]=useState('');const[link,setLink]=useState('');const[linkType,setLinkType]=useState('');const[showEmojiPicker,setShowEmojiPicker]=useState(false);const[showLinkPopup,setShowLinkPopup]=useState(false);const[characterCount,setCharacterCount]=useState(0);const textareaRef=useRef(null);const handleLinkSubmit=()=>{setLinkType('image');// Example type\nsetShowLinkPopup(false);};const handleEmojiClick=emoji=>{setInputValue(prev=>prev+emoji.emoji);// Insert emoji\nsetCharacterCount(prev=>prev+emoji.emoji.length);};const handleTextChange=e=>{setInputValue(e.target.value);setCharacterCount(e.target.value.length);};const handleTextAreaExpand=()=>{if(textareaRef.current){textareaRef.current.style.height='auto';const newHeight=Math.min(textareaRef.current.scrollHeight,8*24);// Max 8 rows\ntextareaRef.current.style.height=\"\".concat(newHeight,\"px\");}};const handleEmojiPickerToggle=()=>{setShowEmojiPicker(prev=>!prev);};const handleLinkPopupToggle=()=>{setShowLinkPopup(prev=>!prev);};const handleSend=async()=>{if(!(selectedChat!==null&&selectedChat!==void 0&&selectedChat.id)||!userId||inputValue.trim()===''){console.error('Error: Chat ID, User ID, or empty message');return;}const date=new Date();if(isNaN(date.getTime())){console.error('Error: Invalid date');return;}console.log('Sending message');const newMessage={id:Date.now().toString(),chat_id:selectedChat.id,content:inputValue.trim(),user_id:userId,status:'pending',created_at:date.toISOString()};// Добавляем сообщение в очередь на отправку\nsetPendingQueue(prevQueue=>[...prevQueue,newMessage]);setMessageStatus(prevStatus=>({...prevStatus,[newMessage.id]:'pending'}));setInputValue('');setCharacterCount(0);};const handleKeyDown=e=>{if(e.key==='Enter'){if(e.shiftKey){e.preventDefault();setInputValue(prev=>prev+'\\n');}else{e.preventDefault();handleSend();}}};return/*#__PURE__*/_jsxs(\"div\",{className:styles.inputArea,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.icon,onClick:handleLinkPopupToggle,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPaperclip})}),showLinkPopup&&/*#__PURE__*/_jsxs(\"div\",{className:styles.linkPopup,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:link,onChange:e=>setLink(e.target.value),placeholder:\"Enter link (max 100 chars)\",maxLength:\"100\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLinkSubmit,children:\"Attach Link\"}),linkType&&/*#__PURE__*/_jsxs(\"div\",{className:styles.linkPreview,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.previewIcon}),/*#__PURE__*/_jsx(\"div\",{className:styles.previewLink,children:link}),/*#__PURE__*/_jsx(\"div\",{className:styles.previewType,children:linkType}),/*#__PURE__*/_jsx(\"button\",{className:styles.removeLink,onClick:()=>setLink(''),children:\"Remove\"})]})]}),/*#__PURE__*/_jsx(\"textarea\",{ref:textareaRef,placeholder:\"\\u041D\\u0430\\u043F\\u0438\\u0441\\u0430\\u0442\\u044C \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435...\",value:inputValue,onChange:handleTextChange,onInput:handleTextAreaExpand,onKeyDown:handleKeyDown,maxLength:\"200\"}),/*#__PURE__*/_jsxs(\"div\",{className:styles.characterCount,children:[characterCount,\"/200\"]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.emojiWrapper,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.icon,onClick:handleEmojiPickerToggle,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faSmile})}),showEmojiPicker&&/*#__PURE__*/_jsx(\"div\",{className:styles.fullEmojiPicker,children:/*#__PURE__*/_jsx(Picker,{onEmojiClick:handleEmojiClick,theme:\"dark\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:styles.icon,onClick:handleSend,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPaperPlane})})]});};export default InputArea;","map":{"version":3,"names":["React","useState","useRef","useContext","styles","FontAwesomeIcon","faPaperclip","faSmile","faPaperPlane","ChatContext","UserContext","Picker","jsx","_jsx","jsxs","_jsxs","InputArea","messages","setMessages","messageStatus","setMessageStatus","selectedChat","pendingQueue","setPendingQueue","userId","inputValue","setInputValue","link","setLink","linkType","setLinkType","showEmojiPicker","setShowEmojiPicker","showLinkPopup","setShowLinkPopup","characterCount","setCharacterCount","textareaRef","handleLinkSubmit","handleEmojiClick","emoji","prev","length","handleTextChange","e","target","value","handleTextAreaExpand","current","style","height","newHeight","Math","min","scrollHeight","concat","handleEmojiPickerToggle","handleLinkPopupToggle","handleSend","id","trim","console","error","date","Date","isNaN","getTime","log","newMessage","now","toString","chat_id","content","user_id","status","created_at","toISOString","prevQueue","prevStatus","handleKeyDown","key","shiftKey","preventDefault","className","inputArea","children","icon","onClick","linkPopup","type","onChange","placeholder","maxLength","linkPreview","previewIcon","previewLink","previewType","removeLink","ref","onInput","onKeyDown","emojiWrapper","fullEmojiPicker","onEmojiClick","theme"],"sources":["C:/Users/player/Documents/GitHub/synask-app/src/pages/messenger/components/InputArea.js"],"sourcesContent":["import React, { useState, useRef, useContext } from 'react';\r\nimport styles from '../styles/InputArea.module.css';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faPaperclip, faSmile, faPaperPlane } from '@fortawesome/free-solid-svg-icons';\r\nimport ChatContext from '../../../components/ChatContext';\r\nimport UserContext from '../../../components/UserContext';\r\nimport Picker from 'emoji-picker-react'; // Updated import\r\n\r\nconst InputArea = () => {\r\n  const { messages, setMessages, messageStatus, setMessageStatus, selectedChat, pendingQueue, setPendingQueue } = useContext(ChatContext);\r\n  const { userId } = useContext(UserContext);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [link, setLink] = useState('');\r\n  const [linkType, setLinkType] = useState('');\r\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n  const [showLinkPopup, setShowLinkPopup] = useState(false);\r\n  const [characterCount, setCharacterCount] = useState(0);\r\n  const textareaRef = useRef(null);\r\n\r\n  const handleLinkSubmit = () => {\r\n    setLinkType('image'); // Example type\r\n    setShowLinkPopup(false);\r\n  };\r\n\r\n  const handleEmojiClick = (emoji) => {\r\n    setInputValue((prev) => prev + emoji.emoji); // Insert emoji\r\n    setCharacterCount((prev) => prev + emoji.emoji.length);\r\n  };\r\n\r\n  const handleTextChange = (e) => {\r\n    setInputValue(e.target.value);\r\n    setCharacterCount(e.target.value.length);\r\n  };\r\n\r\n  const handleTextAreaExpand = () => {\r\n    if (textareaRef.current) {\r\n      textareaRef.current.style.height = 'auto';\r\n      const newHeight = Math.min(textareaRef.current.scrollHeight, 8 * 24); // Max 8 rows\r\n      textareaRef.current.style.height = `${newHeight}px`;\r\n    }\r\n  };\r\n\r\n  const handleEmojiPickerToggle = () => {\r\n    setShowEmojiPicker((prev) => !prev);\r\n  };\r\n\r\n  const handleLinkPopupToggle = () => {\r\n    setShowLinkPopup((prev) => !prev);\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!selectedChat?.id || !userId || inputValue.trim() === '') {\r\n      console.error('Error: Chat ID, User ID, or empty message');\r\n      return;\r\n    }\r\n\r\n    const date = new Date();\r\n    if (isNaN(date.getTime())) {\r\n      console.error('Error: Invalid date');\r\n      return;\r\n    }\r\n\r\n    console.log('Sending message');\r\n\r\n    const newMessage = {\r\n      id: Date.now().toString(),\r\n      chat_id: selectedChat.id,\r\n      content: inputValue.trim(),\r\n      user_id: userId,\r\n      status: 'pending',\r\n      created_at: date.toISOString(),\r\n    };\r\n\r\n    // Добавляем сообщение в очередь на отправку\r\n    setPendingQueue((prevQueue) => [...prevQueue, newMessage]);\r\n\r\n    setMessageStatus((prevStatus) => ({\r\n      ...prevStatus,\r\n      [newMessage.id]: 'pending',\r\n    }));\r\n\r\n    setInputValue('');\r\n    setCharacterCount(0);\r\n  };\r\n\r\n  const handleKeyDown = (e) => {\r\n    if (e.key === 'Enter') {\r\n      if (e.shiftKey) {\r\n        e.preventDefault();\r\n        setInputValue((prev) => prev + '\\n');\r\n      } else {\r\n        e.preventDefault();\r\n        handleSend();\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={styles.inputArea}>\r\n      <div className={styles.icon} onClick={handleLinkPopupToggle}>\r\n        <FontAwesomeIcon icon={faPaperclip} />\r\n      </div>\r\n      {showLinkPopup && (\r\n        <div className={styles.linkPopup}>\r\n          <input\r\n            type=\"text\"\r\n            value={link}\r\n            onChange={(e) => setLink(e.target.value)}\r\n            placeholder=\"Enter link (max 100 chars)\"\r\n            maxLength=\"100\"\r\n          />\r\n          <button onClick={handleLinkSubmit}>Attach Link</button>\r\n          {linkType && (\r\n            <div className={styles.linkPreview}>\r\n              <div className={styles.previewIcon}>{/* Placeholder for preview */}</div>\r\n              <div className={styles.previewLink}>{link}</div>\r\n              <div className={styles.previewType}>{linkType}</div>\r\n              <button className={styles.removeLink} onClick={() => setLink('')}>Remove</button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      <textarea\r\n        ref={textareaRef}\r\n        placeholder=\"Написать сообщение...\"\r\n        value={inputValue}\r\n        onChange={handleTextChange}\r\n        onInput={handleTextAreaExpand}\r\n        onKeyDown={handleKeyDown}\r\n        maxLength=\"200\"\r\n      />\r\n      <div className={styles.characterCount}>{characterCount}/200</div>\r\n      <div className={styles.emojiWrapper}>\r\n        <div\r\n          className={styles.icon}\r\n          onClick={handleEmojiPickerToggle}\r\n        >\r\n          <FontAwesomeIcon icon={faSmile} />\r\n        </div>\r\n        {showEmojiPicker && (\r\n          <div className={styles.fullEmojiPicker}>\r\n            <Picker onEmojiClick={handleEmojiClick} theme=\"dark\" />\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className={styles.icon} onClick={handleSend}>\r\n        <FontAwesomeIcon icon={faPaperPlane} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InputArea;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}