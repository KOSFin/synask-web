{"ast":null,"code":"import React,{useState,useContext,useEffect}from'react';import{deleteMessageById,updateMessageById}from'../../../components/utils';// функции для удаления и обновления\nimport UserContext from'../../../components/UserContext';import styles from'../styles/MessageMenu.module.css';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faEdit,faTrashAlt,faTimes,faSave}from'@fortawesome/free-solid-svg-icons';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MessageMenu=_ref=>{let{message,position,onClose,onMessageUpdated}=_ref;const{userId}=useContext(UserContext);const[isEditing,setIsEditing]=useState(false);const[newContent,setNewContent]=useState(message.content);const[menuPosition,setMenuPosition]=useState(position);const[isActive,setIsActive]=useState(false);// Проверка доступа к меню (только для сообщений пользователя)\nconst canEditOrDelete=message.user_id===userId;useEffect(()=>{// Установить класс active через 10ms после рендеринга\nconst timer=setTimeout(()=>{setIsActive(true);},10);// Задержка в 10ms для плавного появления\n// Очистить таймер при размонтировании компонента\nreturn()=>clearTimeout(timer);},[]);useEffect(()=>{// Проверка границ экрана и корректировка позиции\nconst adjustPosition=()=>{const menuHeight=150;// Примерная высота меню\nconst menuWidth=300;// Примерная ширина меню\nconst adjustedX=position.x+menuWidth>window.innerWidth?window.innerWidth-menuWidth-10:position.x;const adjustedY=position.y+menuHeight>window.innerHeight?window.innerHeight-menuHeight-10:position.y;setMenuPosition({x:adjustedX,y:adjustedY});};adjustPosition();},[position]);const handleDeleteMessage=async()=>{const result=await deleteMessageById(message.id);if(result.success){onClose();// Закрыть меню после удаления\n}else{alert('Ошибка при удалении сообщения.');}};const handleUpdateMessage=async()=>{const result=await updateMessageById(message.id,newContent);if(result.success){onMessageUpdated(message.id,newContent);// Обновить сообщение в UI\nsetIsEditing(false);// Выход из режима редактирования\n}else{alert('Ошибка при обновлении сообщения.');}};return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(styles.overlay,\" \").concat(isActive?styles.active:''),onClick:onClose,children:/*#__PURE__*/_jsx(\"div\",{className:styles.menu,onClick:e=>e.stopPropagation(),style:{left:menuPosition.x,top:menuPosition.y,position:'absolute'},children:canEditOrDelete?/*#__PURE__*/_jsx(_Fragment,{children:isEditing?/*#__PURE__*/_jsxs(\"div\",{className:styles.editContainer,children:[/*#__PURE__*/_jsx(\"textarea\",{className:styles.textarea,value:newContent,onChange:e=>setNewContent(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:styles.actions,children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleUpdateMessage,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faSave}),\" \\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setIsEditing(false),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes}),\" \\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"]})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:styles.actions,children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setIsEditing(true),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faEdit}),\" \\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDeleteMessage,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTrashAlt}),\" \\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"]})]})}):/*#__PURE__*/_jsx(\"div\",{className:styles.noActions,children:\"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F \\u0441 \\u044D\\u0442\\u0438\\u043C \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\\u043C \\u043D\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\"})})});};export default MessageMenu;","map":{"version":3,"names":["React","useState","useContext","useEffect","deleteMessageById","updateMessageById","UserContext","styles","FontAwesomeIcon","faEdit","faTrashAlt","faTimes","faSave","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MessageMenu","_ref","message","position","onClose","onMessageUpdated","userId","isEditing","setIsEditing","newContent","setNewContent","content","menuPosition","setMenuPosition","isActive","setIsActive","canEditOrDelete","user_id","timer","setTimeout","clearTimeout","adjustPosition","menuHeight","menuWidth","adjustedX","x","window","innerWidth","adjustedY","y","innerHeight","handleDeleteMessage","result","id","success","alert","handleUpdateMessage","className","concat","overlay","active","onClick","children","menu","e","stopPropagation","style","left","top","editContainer","textarea","value","onChange","target","actions","icon","noActions"],"sources":["C:/Users/player/Documents/GitHub/synask-app/src/pages/messenger/components/MessageMenu.js"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport { deleteMessageById, updateMessageById } from '../../../components/utils'; // функции для удаления и обновления\r\nimport UserContext from '../../../components/UserContext';\r\nimport styles from '../styles/MessageMenu.module.css';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faEdit, faTrashAlt, faTimes, faSave } from '@fortawesome/free-solid-svg-icons';\r\n\r\nconst MessageMenu = ({ message, position, onClose, onMessageUpdated }) => {\r\n  const { userId } = useContext(UserContext);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [newContent, setNewContent] = useState(message.content);\r\n  const [menuPosition, setMenuPosition] = useState(position);\r\n  const [isActive, setIsActive] = useState(false);\r\n\r\n  // Проверка доступа к меню (только для сообщений пользователя)\r\n  const canEditOrDelete = message.user_id === userId;\r\n\r\n  useEffect(() => {\r\n    // Установить класс active через 10ms после рендеринга\r\n    const timer = setTimeout(() => {\r\n      setIsActive(true);\r\n    }, 10); // Задержка в 10ms для плавного появления\r\n\r\n    // Очистить таймер при размонтировании компонента\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Проверка границ экрана и корректировка позиции\r\n    const adjustPosition = () => {\r\n      const menuHeight = 150; // Примерная высота меню\r\n      const menuWidth = 300; // Примерная ширина меню\r\n      const adjustedX = position.x + menuWidth > window.innerWidth ? window.innerWidth - menuWidth - 10 : position.x;\r\n      const adjustedY = position.y + menuHeight > window.innerHeight ? window.innerHeight - menuHeight - 10 : position.y;\r\n      setMenuPosition({ x: adjustedX, y: adjustedY });\r\n    };\r\n    adjustPosition();\r\n  }, [position]);\r\n\r\n  const handleDeleteMessage = async () => {\r\n    const result = await deleteMessageById(message.id);\r\n    if (result.success) {\r\n      onClose(); // Закрыть меню после удаления\r\n    } else {\r\n      alert('Ошибка при удалении сообщения.');\r\n    }\r\n  };\r\n\r\n  const handleUpdateMessage = async () => {\r\n    const result = await updateMessageById(message.id, newContent);\r\n    if (result.success) {\r\n      onMessageUpdated(message.id, newContent); // Обновить сообщение в UI\r\n      setIsEditing(false); // Выход из режима редактирования\r\n    } else {\r\n      alert('Ошибка при обновлении сообщения.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`${styles.overlay} ${isActive ? styles.active : ''}`} onClick={onClose}>\r\n      <div\r\n        className={styles.menu}\r\n        onClick={(e) => e.stopPropagation()}\r\n        style={{ left: menuPosition.x, top: menuPosition.y, position: 'absolute' }}\r\n      >\r\n        {canEditOrDelete ? (\r\n          <>\r\n            {isEditing ? (\r\n              <div className={styles.editContainer}>\r\n                <textarea\r\n                  className={styles.textarea}\r\n                  value={newContent}\r\n                  onChange={(e) => setNewContent(e.target.value)}\r\n                />\r\n                <div className={styles.actions}>\r\n                  <button onClick={handleUpdateMessage}>\r\n                    <FontAwesomeIcon icon={faSave} /> Сохранить\r\n                  </button>\r\n                  <button onClick={() => setIsEditing(false)}>\r\n                    <FontAwesomeIcon icon={faTimes} /> Отмена\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className={styles.actions}>\r\n                <button onClick={() => setIsEditing(true)}>\r\n                  <FontAwesomeIcon icon={faEdit} /> Редактировать\r\n                </button>\r\n                <button onClick={handleDeleteMessage}>\r\n                  <FontAwesomeIcon icon={faTrashAlt} /> Удалить\r\n                </button>\r\n              </div>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <div className={styles.noActions}>Действия с этим сообщением недоступны</div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessageMenu;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}